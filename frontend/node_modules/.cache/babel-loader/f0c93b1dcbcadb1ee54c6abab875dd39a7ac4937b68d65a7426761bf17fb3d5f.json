{"ast":null,"code":"const API_BASE_URL = process.env.NODE_ENV === 'production' ? '/api' : 'http://localhost:8000';\n\n// Global auth handler that can be set by AuthContext\nlet authErrorHandler = null;\nexport function setAuthErrorHandler(handler) {\n  authErrorHandler = handler;\n}\nexport async function apiCall(endpoint, method = 'GET', data = null) {\n  const url = `${API_BASE_URL}${endpoint}`;\n  const config = {\n    method,\n    headers: {\n      'Content-Type': 'application/json',\n      'X-Requested-With': 'XMLHttpRequest' // CSRF protection\n    }\n  };\n  if (data && method !== 'GET') {\n    // Sanitize data before sending\n    const sanitizedData = sanitizeObject(data);\n    config.body = JSON.stringify(sanitizedData);\n  }\n  try {\n    const response = await fetch(url, config);\n    if (!response.ok) {\n      const errorData = await response.json().catch(() => ({}));\n      throw new Error(errorData.detail || `HTTP ${response.status}: ${response.statusText}`);\n    }\n    const contentType = response.headers.get('content-type');\n    if (contentType && contentType.includes('application/json')) {\n      const result = await response.json();\n      // Don't sanitize trusted fields that contain URLs or repository names\n      return sanitizeObject(result, ['auth_url', 'redirect_url', 'name', 'full_name', 'login', 'avatar_url']);\n    } else {\n      return await response.text();\n    }\n  } catch (error) {\n    console.error('API call failed:', error);\n    throw error;\n  }\n}\nfunction sanitizeObject(obj, skipSanitizeKeys = []) {\n  if (obj === null || obj === undefined) {\n    return obj;\n  }\n  if (typeof obj === 'string') {\n    return sanitizeString(obj);\n  }\n  if (Array.isArray(obj)) {\n    return obj.map(item => sanitizeObject(item, skipSanitizeKeys));\n  }\n  if (typeof obj === 'object') {\n    const sanitized = {};\n    for (const [key, value] of Object.entries(obj)) {\n      if (skipSanitizeKeys.includes(key) && typeof value === 'string') {\n        sanitized[key] = value; // Don't sanitize trusted URL fields\n      } else {\n        sanitized[key] = sanitizeObject(value, skipSanitizeKeys);\n      }\n    }\n    return sanitized;\n  }\n  return obj;\n}\nfunction sanitizeString(str) {\n  // Basic XSS prevention - encode HTML entities\n  // Note: Forward slashes are safe in JSON and don't need encoding\n  return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;').replace(/'/g, '&#x27;');\n}\nexport function formatDate(dateString) {\n  const date = new Date(dateString);\n  return date.toLocaleDateString('en-US', {\n    year: 'numeric',\n    month: 'short',\n    day: 'numeric'\n  });\n}\nexport function formatNumber(num) {\n  if (num >= 1000000) {\n    return (num / 1000000).toFixed(1) + 'M';\n  } else if (num >= 1000) {\n    return (num / 1000).toFixed(1) + 'K';\n  }\n  return num.toString();\n}","map":{"version":3,"names":["API_BASE_URL","process","env","NODE_ENV","authErrorHandler","setAuthErrorHandler","handler","apiCall","endpoint","method","data","url","config","headers","sanitizedData","sanitizeObject","body","JSON","stringify","response","fetch","ok","errorData","json","catch","Error","detail","status","statusText","contentType","get","includes","result","text","error","console","obj","skipSanitizeKeys","undefined","sanitizeString","Array","isArray","map","item","sanitized","key","value","Object","entries","str","replace","formatDate","dateString","date","Date","toLocaleDateString","year","month","day","formatNumber","num","toFixed","toString"],"sources":["/Users/ayush/Desktop/Projects/github-code-visualise/frontend/src/utils/api.js"],"sourcesContent":["const API_BASE_URL = process.env.NODE_ENV === 'production' \n  ? '/api' \n  : 'http://localhost:8000';\n\n// Global auth handler that can be set by AuthContext\nlet authErrorHandler = null;\n\nexport function setAuthErrorHandler(handler) {\n  authErrorHandler = handler;\n}\n\nexport async function apiCall(endpoint, method = 'GET', data = null) {\n  const url = `${API_BASE_URL}${endpoint}`;\n  \n  const config = {\n    method,\n    headers: {\n      'Content-Type': 'application/json',\n      'X-Requested-With': 'XMLHttpRequest', // CSRF protection\n    },\n  };\n\n  if (data && method !== 'GET') {\n    // Sanitize data before sending\n    const sanitizedData = sanitizeObject(data);\n    config.body = JSON.stringify(sanitizedData);\n  }\n\n  try {\n    const response = await fetch(url, config);\n    \n    if (!response.ok) {\n      const errorData = await response.json().catch(() => ({}));\n      throw new Error(errorData.detail || `HTTP ${response.status}: ${response.statusText}`);\n    }\n\n    const contentType = response.headers.get('content-type');\n    if (contentType && contentType.includes('application/json')) {\n      const result = await response.json();\n      // Don't sanitize trusted fields that contain URLs or repository names\n      return sanitizeObject(result, ['auth_url', 'redirect_url', 'name', 'full_name', 'login', 'avatar_url']); \n    } else {\n      return await response.text();\n    }\n  } catch (error) {\n    console.error('API call failed:', error);\n    throw error;\n  }\n}\n\nfunction sanitizeObject(obj, skipSanitizeKeys = []) {\n  if (obj === null || obj === undefined) {\n    return obj;\n  }\n\n  if (typeof obj === 'string') {\n    return sanitizeString(obj);\n  }\n\n  if (Array.isArray(obj)) {\n    return obj.map(item => sanitizeObject(item, skipSanitizeKeys));\n  }\n\n  if (typeof obj === 'object') {\n    const sanitized = {};\n    for (const [key, value] of Object.entries(obj)) {\n      if (skipSanitizeKeys.includes(key) && typeof value === 'string') {\n        sanitized[key] = value; // Don't sanitize trusted URL fields\n      } else {\n        sanitized[key] = sanitizeObject(value, skipSanitizeKeys);\n      }\n    }\n    return sanitized;\n  }\n\n  return obj;\n}\n\nfunction sanitizeString(str) {\n  // Basic XSS prevention - encode HTML entities\n  // Note: Forward slashes are safe in JSON and don't need encoding\n  return str\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#x27;');\n}\n\nexport function formatDate(dateString) {\n  const date = new Date(dateString);\n  return date.toLocaleDateString('en-US', {\n    year: 'numeric',\n    month: 'short',\n    day: 'numeric'\n  });\n}\n\nexport function formatNumber(num) {\n  if (num >= 1000000) {\n    return (num / 1000000).toFixed(1) + 'M';\n  } else if (num >= 1000) {\n    return (num / 1000).toFixed(1) + 'K';\n  }\n  return num.toString();\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}